- if @page.occurrence_map?
  - content_for :head do
    - prefix = @page.id.to_i % 100
    = javascript_include_tag "http://maps.google.com/maps/api/js?key=#{Rails.application.secrets.google_maps_key}"
    = javascript_include_tag "maps_vendored"
    = javascript_include_tag "http://media.eol.org/content/maps/#{prefix}/#{@page.id}.json"
    = javascript_include_tag "maps"
#page.container{"data-turbolinks": "false"}
  #page_control{ ng: { controller: "PageCtrl as ctrl" } }
    .ui.container
      .ui.grid
        .eight.wide.column
          -# NOTE: it doesn't cache this, so we store it rather than call it over
          -# and over:
          - ancestors = @page.native_node.ancestors
          #breadcrumbs.page-ancestors.ui.breadcrumb
            - shown_ellipsis = false
            - ancestors.each do |node|
              - unless node.has_breadcrumb?
                - unless shown_ellipsis
                  = link_to("â€¦", page_breadcrumbs_path(page_id: @page.id), class: "section", remote: true)
                  %i.right.chevron.icon.divider
                  - shown_ellipsis = true
                - next
              = link_to(node.canonical_form.html_safe, node.page_id ? page_path(node.page_id) : "#", class: "section")
              - shown_ellipsis = false
              - unless node == ancestors.last
                %i.right.chevron.icon.divider
          .ui.divider
          .ui.grid
            .page-names.ten.wide.column
              %h1= @page.name.titlecase
              %h2= @page.scientific_name.html_safe
            %p.six.wide.column.actions
              = link_to("<i class='plus icon'></i>".html_safe + t(:taxon_collect_button), new_collected_page_path(page_id: @page.id), class: "ui labeled small icon button")
          .ui.segment.light.orange.secondary
            = "The #{@page.name} are animals "
            - if ancestors[-2]
              = "in the #{ancestors[-2].rank.try(:name) || "clade"} #{ancestors[-2].name}."
            They live in a variety of habitats around the world.
          .ui.section
            %h3.ui.dividing.header= "Key Traits"
            .ui.list
              - preds = {}
              - @page.traits.each do |trait|
                - unless preds.keys.size >= 5
                  - predicate = @page.glossary[trait[:predicate][:uri]]
                  - unless preds.has_key?(predicate)
                    - preds[predicate] = true
                    .item
                      = link_to(predicate[:name], term_path(uri: predicate[:uri]))
                      .header
                        - show_trait_value(trait)

        .eight.wide.column
          .ui.container= image_tag(@page.media.first.large_size_url, class: "ui fluid bordered image")
    #page_nav.ui.secondary.pointing.menu
      - if @page.media_count > 0
        = link_to("<div data-tooltip='#{t("pages.tabs.media")}'><i class='big image icon'></i><div class='ui circular orange label' >#{@page.media_count}</div></div>".html_safe, page_media_path(page_id: @page.id), class: "active item", id: "page_nav_media", remote: true)
      - if @page.traits
        = link_to("<div data-tooltip='#{t("pages.tabs.traits")}'><i class='big bar chart icon'></i><div class='ui circular orange label'>#{@page.traits.size}</div></div>".html_safe, page_traits_path(page_id: @page.id), class: "item", id: "page_nav_traits", remote: true)
      - if @page.map?
        -# TODO: We want a real count there, eventually.
          = link_to(t("pages.tabs.maps", count: 1).html_safe, page_maps_path(page_id: @page.id), class: "item", id: "page_nav_maps", remote: true)
      = link_to("<div data-tooltip='#{t("pages.tabs.classifications")}'><i class='big sitemap icon'></i><div class='ui circular orange label' >#{@page.nodes.size}</div></div>".html_safe, page_classifications_path(page_id: @page.id), class: "item", id: "page_nav_classifications", remote: true)
      - if @page.articles.size > 0
        = link_to("<div data-tooltip='#{t("pages.tabs.details")}'><i class='big book icon'></i><div class='ui circular orange label' >#{@page.articles.size}</div></div>".html_safe, page_details_path(page_id: @page.id), class: "item", id: "page_nav_details", remote: true)
      = link_to("<div data-tooltip='#{t("pages.tabs.names")}'><i class='big comments icon'></i><div class='ui circular orange label' >#{@page.names_count}</div></div>".html_safe, page_names_path(page_id: @page.id), class: "item", id: "page_nav_names", remote: true)
      - if @page.literature_and_references_count > 1
        = link_to("<div data-tooltip='#{t("pages.tabs.literature_and_references")}'><i class='big bookmark icon'></i><div class='ui circular orange label' >#{@page.literature_and_references_count}</div></div>".html_safe, page_literature_and_references_path(page_id: @page.id), class: "item", id: "page_nav_literature_and_references", remote: true)
    #page_nav_content.ui.content.dimmable
      = render("page_media")
