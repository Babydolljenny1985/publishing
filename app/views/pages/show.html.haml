- if @page.occurrence_map?
  - content_for :head do
    - prefix = @page.id.to_i % 100
    = javascript_include_tag "http://maps.google.com/maps/api/js?key=#{Rails.application.secrets.google_maps_key}"
    = javascript_include_tag "maps_vendored"
    = javascript_include_tag "http://media.eol.org/content/maps/#{prefix}/#{@page.id}.json"
    = javascript_include_tag "maps"
#page
  -# NOTE: it doesn't cache this, so we store it rather than call it over
  -# and over:
  .uk-section.uk-section-default.uk-grid-small.uk-padding-small.uk-box-shadow-medium{ uk: { grid: true } }
    .uk-section.uk-padding-remove-vertical.uk-width-3-5
      #breadcrumbs.page-ancestors.uk-column-span
        %ul.uk-breadcrumb.uk-heading-divider.eol-padding-tiny
          - ancestors = @page.native_node.ancestors
          - shown_ellipsis = false
          - ancestors.each do |node|
            - unless node.has_breadcrumb?
              - unless shown_ellipsis
                %li= link_to("â€¦", page_breadcrumbs_path(page_id: @page.id), remote: true)
                - shown_ellipsis = true
              - next
            %li= link_to(node.canonical_form.html_safe, node.page_id ? page_path(node.page_id) : "#")
            - shown_ellipsis = false
      .uk-section{ uk: { grid: true } }
        #names.page-names.uk-width-2-3
          - if @page.name == @page.scientific_name
            %h1.uk-margin-small-bottom= @page.name.html_safe
          - else
            %h1.uk-margin-small-bottom= @page.name.titlecase.html_safe
            %h3.uk-margin-remove-top.uk-text-muted= @page.scientific_name.html_safe
        .uk-width-1-3
          %a.ui.labeled.small.icon.button.uk-box-shadow-medium{ href: new_collected_page_path(page_id: @page.id) }
            %i.plus.icon
            = t(:taxon_collect_button)
      .uk-section.eol-section-aged.uk-box-shadow-medium.uk-text-lead.uk-text-center.uk-padding-small.uk-margin-small-top.uk-margin-medium-right
        = construct_summary(@page)
      - unless @page.traits.empty?
        .uk-section.uk-padding-remove-vertical.uk-margin-top.uk-text-small
          %h3.uk-heading-divider
            = t(:page_key_traits_header)
          %dl.uk-description-list
            - preds = {}
            - @page.traits.each do |trait|
              - unless preds.keys.size >= 5
                - predicate = @page.glossary[trait[:predicate][:uri]]
                - unless preds.has_key?(predicate)
                  - preds[predicate] = true
                  %dt.uk-margin-small-top= link_to(predicate[:name], term_path(uri: predicate[:uri]))
                  %dd
                    - show_trait_value(trait)
    - if @page.top_image
      .uk-width-2-5
        .uk-margin-remove-top
          .uk-overflow-hidden.uk-box-shadow-large.eol-bordered-image
            %img.uk-animation-kenburns.uk-animation-reverse{ src: @page.top_image.original_size_url }
        .uk-float-right.uk-margin-medium-top
          .ui.label.eol-secondary.uk-box-shadow-medium
            = t("pages.iucn_status.label")
            .detail= t("pages.iucn_status.#{@page.iucn_status_key}")

  .uk-section.uk-padding-remove-vertical.uk-margin-top
    %ul#page_nav.uk-tab.uk-child-width-expand
      - if @page.media_count > 0
        - tab(name: "media", icon: "image", count: @page.media_count, path: page_media_path(page_id: @page.id), active: true)
      - unless @page.traits.empty?
        - tab(name: "traits", icon: "tag", count: @page.traits_count, path: page_traits_path(page_id: @page.id))
      - if @page.map?
        -# TODO: We want to use @page.maps_count here, eventually. ...but we don't SHOW those maps yet...
        - tab(name: "maps", icon: "world", count: 1, path: page_maps_path(page_id: @page.id))
      - if @page.articles.size > 0
        - tab(name: "details", icon: "info", count: @page.articles_count, path: page_details_path(page_id: @page.id))
      - tab(name: "classifications", icon: "git-branch", count: @page.nodes_count, path: page_classifications_path(page_id: @page.id))
      - tab(name: "names", icon: "quote-right", count: @page.names_count, path: page_names_path(page_id: @page.id))
      - if @page.literature_and_references_count > 1
        - tab(name: "literature_and_references", icon: "bookmark", count: @page.literature_and_references_count, path: page_literature_and_references_path(page_id: @page.id))
    #page_nav_content
      - if @page.media_count > 0
        = render("page_media")
      - elsif ! @page.traits.empty?
        = render("page_traits")
      - else
        = render("page_classification")
