!!!
%html
  %head
    %meta{content: "text/html; charset=UTF-8", "http-equiv": "Content-Type"}/
    %title EolWebsite
    = stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': true
    = stylesheet_link_tag 'main_en'
    = stylesheet_link_tag 'http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css'
    = javascript_include_tag 'application', 'data-turbolinks-track': true
    = javascript_include_tag "http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.min.js"
    = javascript_include_tag "http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-aria.min.js"
    = javascript_include_tag "http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.js"
    = csrf_meta_tags
  %body

    %script{ "type" => "text/ng-template", id: "pageAutocompleteTemplate.html" }

    .header
      .search{ "ng-app" => "searchApp" }
        %div{ "ng-controller" => "SearchCtrl as ctrl", "layout" => "column" }
          %md-content.md-padding
            = form_tag(search_path, method: "get") do
              %pre
                {{ pageSelected | json }}
              %md-autocomplete{ "md-selected-item" => "ctrl.selectedItem",
                "md-search-text-change" => "ctrl.searchTextChange(ctrl.searchText)",
                "md-search-text" => "ctrl.searchText",
                "md-selected-item-change" => "ctrl.selectedItemChange(item)",
                "md-items" => "item in ctrl.querySearch(ctrl.searchText)",
                "md-item-text" => "item.scientific_name",
                "md-input-id" => "q",
                "md-input-name" => "q",
                "md-min-length" => "1",
                "placeholder" => t(:search_layout_placeholder) }
                %md-item-template
                  %span.result
                    %img{ "ng-src" => "{{ item.top_image.small_icon_url }}", height: "33" }
                    %span{ "md-highlight-text" => "ctrl.searchText", "md-highlight-flags" => "i", "ng-bind-html" => "item.scientific_name | htmlSafe"}
                      Hi
                    %span{ "md-highlight-text" => "ctrl.searchText", "md-highlight-flags" => "i" }
                      {{ item.scientific_name }}
                    %span{ "md-highlight-text" => "ctrl.searchText", "md-highlight-flags" => "i",
                      "ng-repeat" => "vern in item.preferred_vernaculars" }
                      {{ vern.string + " (" + vern.language.code + ") " }}
                      -# {{ item.preferred_vernaculars.join(", ") | html_safe }}
                    %md-not-found
                      = t(:search_empty, q: "{{ ctrl.searchText }}")
              = submit_tag "Go"
    - flash.each do |name, msg|
      - next if name ==  :recaptcha_error.to_s
      - if msg.class == Array
        - msg.each do |message|
          = content_tag :p, message, :id => "flash_#{name}"
      - else
        = content_tag :p, msg, :id => "flash_#{name}"
    = yield
